/*
  ST7032 I2C LCD Controler
  Ekran ikonlari
  firat_soygul@hotmail.com
  
 ------------------------
  Arduino        ST7032
 ------------------------
  3.3V    --+-- VDD
            +-- RST
  A4(SDA) --*-- SDA
  A5(SCL) --*-- SCL
  GND     ----- GND
  
  *... 10Kohm pull-up
 ------------------------
*/

#include <Wire.h>
#include <ST7032.h>


#define NELEMS(arg) (sizeof(arg) / sizeof((arg)[0]))

typedef struct tagICON_MAP {
  byte addr;
  byte pat;
}ICON_MAP;

static const ICON_MAP iconMap[] = {
  { 0x16, (1<<0) },    // 
  { 0x16, (1<<1) },    // 
  { 0x16, (1<<2) },    // 
  { 0x16, (1<<3) },    // 
  { 0x16, (1<<4) },    // 
  { 0x16, (1<<5) },    // 
  { 0x16, (1<<6) },    // 
  { 0x16, (1<<7) },    // 
  { 0x16, (1<<8) },    // 
  { 0x16, (1<<9) },    // 
  { 0x16, (1<<10) },    // 
  { 0x32, (1<<4) },    // 
  { 0x33, (1<<1) },    // 
  { 0x33, (1<<2) },    // 
  { 0x33, (1<<3) },    // 
  { 0x33, (1<<4) },    // 
  { 0x34, (1<<1) },    // 
  { 0x34, (1<<2) },    // 
  { 0x34, (1<<3) },    // x
  { 0x34, (1<<4) },    // ahize
  { 0x34, (1<<1) },    //
  { 0x35, (1<<2) },    // 
  { 0x35, (1<<3) },    // 
  { 0x35, (1<<4) },    // 
  { 0x36, (1<<1) },    // 
  { 0x36, (1<<2) },    // 
  { 0x36, (1<<3) },    // 
  { 0x36, (1<<4) },    // 
  { 0x37, (1<<1) },    // 
  { 0x37, (1<<2) },    // 
  { 0x37, (1<<3) },    // 
  { 0x37, (1<<4) },    // 
  { 0x38, (1<<1) },    // 
  { 0x38, (1<<2) },    // 
  { 0x38, (1<<3) },    // 
  { 0x38, (1<<4) },    // 
  { 0x39, (1<<1) },    // 
  { 0x39, (1<<2) },    // 
  { 0x39, (1<<3) },    // 
  { 0x39, (1<<4) },    // 
  { 0x3A, (1<<1) },    // 
  { 0x3A, (1<<2) },    // 
  { 0x3A, (1<<3) },    // 
  { 0x3A, (1<<4) },    // 
  { 0x3B, (1<<1) },    // 
  { 0x3B, (1<<2) },    // 
  { 0x3B, (1<<3) },    // 
  { 0x3B, (1<<4) },    // 
  { 0x3C, (1<<1) },    // 
  { 0x3C, (1<<2) },    // 
  { 0x3C, (1<<3) },    // 
  { 0x3C, (1<<4) },    // 
  { 0x3D, (1<<1) },    // 
  { 0x3D, (1<<2) },    // 
  { 0x3D, (1<<3) },    // 
  { 0x3D, (1<<4) },    // 
  { 0x3E, (1<<1) },    // 
  { 0x3E, (1<<2) },    // 
  { 0x3E, (1<<3) },    // 
  { 0x3E, (1<<4) },    // 
  { 0x3F, (1<<1) },    // 
  { 0x3F, (1<<2) },    // 
  { 0x3F, (1<<3) },    // 
  { 0x3F, (1<<4) },    // 
  { 0x00, (1<<4) },    // 0 - Batarya 4
  { 0x00, (1<<3) },    // Batarya 3
  { 0x00, (1<<2) },    // Batarya 2
  { 0x00, (1<<1) },    // Batarya 1
  { 0x01, (1<<4) },    // Sol OK yanındaki nokta
  { 0x01, (1<<3) },    // 
  { 0x01, (1<<2) },    // 
  { 0x01, (1<<1) },    // 
  { 0x02, (1<<4) },    // 
  { 0x02, (1<<3) },    // 
  { 0x02, (1<<2) },    // 10 - OK
  { 0x02, (1<<1) },    // 
  { 0x03, (1<<4) },    // 
  { 0x03, (1<<3) },    // 
  { 0x03, (1<<2) },    // 
  { 0x03, (1<<1) },    // 
  { 0x04, (1<<4) },    // Telefon Ahize
  { 0x04, (1<<3) },    // Ahize Kapalı (x)
  { 0x04, (1<<2) },    // 18 - Ahize Açık ))
  { 0x04, (1<<1) },    // 
  { 0x05, (1<<4) },    // 
  { 0x05, (1<<3) },    // 
  { 0x05, (1<<2) },    // 
  { 0x05, (1<<1) },    // 
  { 0x06, (1<<4) },    // 
  { 0x06, (1<<3) },    // 
  { 0x06, (1<<2) },    //
  { 0x06, (1<<1) },    // 
  { 0x07, (1<<4) },    // 
  { 0x07, (1<<3) },    // 
  { 0x07, (1<<2) },    // 
  { 0x07, (1<<1) },    // 
  { 0x08, (1<<4) },    // 
  { 0x08, (1<<3) },    // 
  { 0x08, (1<<2) },    // 
  { 0x08, (1<<1) },    // 
  { 0x09, (1<<4) },    // 
  { 0x09, (1<<3) },    // 
  { 0x09, (1<<2) },    // 
  { 0x09, (1<<1) },    // 
  { 0x0A, (1<<4) },    //
  { 0x0A, (1<<3) },    // 
  { 0x0A, (1<<2) },    // 
  { 0x0A, (1<<1) },    // 
  { 0x0B, (1<<4) },    // 
  { 0x0B, (1<<3) },    // 
  { 0x0B, (1<<2) },    // 
  { 0x0B, (1<<1) },    // 
  { 0x0C, (1<<4) },    // 
  { 0x0C, (1<<3) },    // 
  { 0x0C, (1<<2) },    // 
  { 0x0C, (1<<1) },    // 
  { 0x0D, (1<<4) },    // 
  { 0x0D, (1<<3) },    // BACK
  { 0x0D, (1<<2) },    // 
  { 0x0D, (1<<1) },    // 
  { 0x0E, (1<<4) },    // BACK sağındaki 1. nokta
  { 0x0E, (1<<3) },    // BACK sağındaki 2. nokta
  { 0x15, (1<<5) },    // Höparlör 
  { 0x0E, (1<<2) },    // 
  { 0x0E, (1<<1) },    //
  { 0x0F, (1<<4) },    //
  { 0x0F, (1<<3) },    // 
  { 0x0F, (1<<2) },    // 
  { 0x0F, (1<<1) },    // 
};

static byte iconTmp[16];
bool showIcon = true;
ST7032 lcd;

static void setIndexedIcon(uint8_t index, bool show) {
  if((0 <= index) && (index < NELEMS(iconMap))) {
    const ICON_MAP* pMap = &iconMap[index];
    byte* pTmp = &iconTmp[pMap->addr];
    
    if(show) {
      *pTmp |= pMap->pat;
    } else {
      *pTmp &= ~pMap->pat;
    }
    
    lcd.setIcon(pMap->addr, *pTmp);
  }
}

void setup(){
  
  lcd.begin(15, 2, LCD_5x8DOTS);
  lcd.setContrast(40);
  lcd.print("ST7032 ICON TEST");
  lcd.clear();
}

void loop(){
  int i;

  for(i = 0; i < NELEMS(iconMap); i++) {
    setIndexedIcon(i, showIcon);
    lcd.setCursor(0, 1);
    lcd.print("No.");
    lcd.print(i);
    lcd.print("  ");
    
    delay(1000);
  }
  
  while(1){}
  
  showIcon = !showIcon;
}
